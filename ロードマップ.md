# 三日坊主バスター - プロダクションリリース ロードマップ

## 現在地（Sprint 0 完了）
- ✅ 要件定義書
- ✅ フロントエンドMVP（HTML/CSS/JS）
- ✅ GitHub Pages で仮公開中
- ❌ バックエンドなし（localStorage のみ）
- ❌ ユーザー認証なし
- ❌ 独自ドメインなし
- ❌ 決済機能なし

---

## Sprint 1: 基盤構築（独自ドメイン + ホスティング移行）
**目標:** 「本物のサービス」としての最低限の体裁を整える

| タスク | 詳細 | 推奨サービス |
|--------|------|-------------|
| ドメイン取得 | 例: `mikka-buster.com` | Cloudflare Registrar / Google Domains |
| ホスティング移行 | 静的サイトのまま高速CDNへ | **Cloudflare Pages**（無料）or Vercel |
| HTTPS設定 | 自動（上記サービスなら標準） | - |
| OGP / SEO対策 | SNSシェア時の画像・説明文 | meta タグ追加 |
| favicon / PWA対応 | ホーム画面追加可能に | manifest.json + Service Worker |
| アクセス解析 | ユーザー数の把握 | Plausible（プライバシー重視）or GA4 |

**この時点の構成:**
```
ユーザー → Cloudflare CDN → 静的ファイル（HTML/CSS/JS）
                              └── localStorage（データ保存）
```

---

## Sprint 2: バックエンド + データベース導入
**目標:** ユーザーデータをクラウドに保存し、端末間で同期可能にする

### 技術選定

| レイヤー | 推奨 | 理由 |
|----------|------|------|
| バックエンド | **Supabase** | PostgreSQL + 認証 + API が一体。無料枠あり。Firebase の OSS 代替 |
| 代替案A | Firebase | Google製。Firestore + Auth。実績豊富 |
| 代替案B | PlanetScale + Hono on Cloudflare Workers | 軽量・高速・低コスト。技術力が必要 |
| データベース | **PostgreSQL**（Supabase内蔵） | 信頼性・拡張性・無料枠のバランス |

### データベース設計（最小構成）

```sql
-- ユーザー（Supabase Auth が管理）
-- auth.users テーブルが自動生成される

-- 習慣
CREATE TABLE habits (
  id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id     UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  name        TEXT NOT NULL,
  period      INT NOT NULL,
  deposit     INT NOT NULL DEFAULT 0,
  start_date  DATE NOT NULL,
  target_rate INT NOT NULL DEFAULT 80,
  created_at  TIMESTAMPTZ DEFAULT now()
);

-- チェックイン記録
CREATE TABLE checkins (
  id        UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  habit_id  UUID REFERENCES habits(id) ON DELETE CASCADE,
  user_id   UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  date      DATE NOT NULL,
  UNIQUE(habit_id, date)
);
```

### タスク

| タスク | 詳細 |
|--------|------|
| Supabase プロジェクト作成 | 無料プランで開始 |
| DB テーブル作成 | 上記スキーマを適用 |
| Row Level Security（RLS）設定 | 自分のデータのみ読み書き可能に |
| フロントエンドを Supabase JS SDK に接続 | localStorage → Supabase API に切り替え |
| オフライン対応 | ネットなしでも動作 → オンライン時に同期 |

**この時点の構成:**
```
ユーザー → Cloudflare CDN → 静的ファイル
                              └── Supabase（PostgreSQL + API）
```

---

## Sprint 3: ユーザー認証
**目標:** アカウント作成・ログインで自分のデータを管理

| タスク | 詳細 |
|--------|------|
| Google ログイン | Supabase Auth の OAuth 設定 |
| メール/パスワード認証 | 追加の選択肢として |
| ログイン/サインアップ画面 | ミニマルなUIで実装 |
| ログアウト機能 | ヘッダーにプロフィールアイコン + メニュー |
| 未ログイン時の動線 | localStorage モードで体験 → ログインで同期を促す |
| 利用規約・プライバシーポリシー | リリースに必須 |

---

## Sprint 4: UX 改善 + エンゲージメント強化
**目標:** 継続率を上げる機能を追加

| タスク | 優先度 |
|--------|--------|
| プッシュ通知 / リマインダー | 高（Service Worker + Web Push） |
| 週間・月間レポート画面 | 高（達成率グラフ、カレンダーヒートマップ） |
| バッジ・称号システム | 中（「1週間マスター」「30日チャンピオン」など） |
| 紙吹雪アニメーション | 中（達成時の演出強化） |
| ダークモード | 中 |
| SNSシェア機能 | 低（「30日達成しました!」をTwitter等に投稿） |

---

## Sprint 5: 決済機能（デポジット実装）
**目標:** 擬似デポジットから実際の課金へ移行

| タスク | 詳細 |
|--------|------|
| Stripe アカウント開設 | 本人確認・事業者登録 |
| Stripe Checkout 統合 | チャレンジ開始時にデポジットを預かる |
| Webhook 処理 | 決済完了 → DB にデポジット記録 |
| 返金ロジック | 達成率80%以上 → 自動返金（Stripe Refund API） |
| 寄付先の選定・連携 | 未達成分の送金先（慈善団体 API or プール） |
| 特定商取引法に基づく表記 | 日本で決済を扱う場合に必須 |
| 資金決済法の確認 | デポジット預かりが規制対象か法務確認 |

### 決済フロー
```
チャレンジ開始
  → Stripe Checkout でデポジット決済
  → 期間中は Stripe に保持
  → 期間終了
    → 達成率 ≥ 80%: Stripe Refund API で全額返金
    → 達成率 < 80%: 寄付先に送金 or プール
```

**この時点の構成:**
```
ユーザー → Cloudflare CDN → フロントエンド
                              ├── Supabase（DB + Auth）
                              └── Stripe（決済）
                                   └── Webhook → Supabase Edge Function
```

---

## Sprint 6: スケーラビリティ + 運用
**目標:** 成長に備えた運用体制

| タスク | 詳細 |
|--------|------|
| エラー監視 | Sentry（無料枠あり） |
| バックアップ | Supabase 自動バックアップ（Pro プラン） |
| CI/CD | GitHub Actions → 自動デプロイ・テスト |
| ステージング環境 | 本番と同じ構成の検証環境 |
| パフォーマンス監視 | Lighthouse CI / Web Vitals |
| ユーザーサポート | お問い合わせフォーム |

---

## コスト見積もり（月額）

| フェーズ | 月額目安 |
|----------|----------|
| Sprint 1（静的サイト） | **¥0〜2,000**（ドメイン代のみ） |
| Sprint 2-3（Supabase Free） | **¥0〜2,000** |
| Sprint 4（Web Push等） | **¥0〜2,000** |
| Sprint 5（Stripe） | **決済手数料 3.6%** + Supabase Pro ¥3,500/月 |
| Sprint 6（運用） | **¥5,000〜15,000/月**（規模次第） |

---

## 推奨スケジュール

| Sprint | 期間目安 | マイルストーン |
|--------|----------|---------------|
| 1 | 1週間 | 独自ドメインで公開 |
| 2 | 2週間 | クラウドDB稼働 |
| 3 | 1週間 | ログイン機能リリース → **正式ローンチ** |
| 4 | 2-3週間 | エンゲージメント機能追加 |
| 5 | 3-4週間 | 決済機能リリース |
| 6 | 継続的 | 運用・改善 |
